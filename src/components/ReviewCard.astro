---
interface Props {
  rank?: number;
  name: string;
  subtitle: string;
  badge?: string;
  badgeType?: 'best' | 'primary' | 'success';
  score: number;
  specs: { label: string; value: string }[];
  pros: string[];
  cons: string[];
  recommendation: string;
  productId: string;
  store?: string;
  reviewUrl?: string;
  image?: string;
}

const {
  rank, name, subtitle, badge, badgeType = 'primary',
  score, specs, pros, cons, recommendation,
  productId, store = 'coupang', reviewUrl, image
} = Astro.props;
---

<div class="review-card">
  <div class="review-card-top">
    {badge && <span class={`badge badge-${badgeType}`}>{badge}</span>}
    <div class="review-score" aria-label={`평점 ${score}점 / 10점`}>
      <span class="score-num">{score}</span><span class="score-total">/10</span>
    </div>
  </div>

  <h3 class="review-title">{rank ? `${rank}. ` : ''}{name}</h3>
  <p class="review-subtitle">{subtitle}</p>

  <div class="review-card-specs">
    {specs.map(s => (
      <span class="spec"><strong>{s.label}:</strong> {s.value}</span>
    ))}
  </div>

  <div class="review-card-middle">
    <div class="review-card-image">
      {image
        ? <img src={image} alt={name} loading="lazy" decoding="async" width="280" height="200" />
        : <div class="product-placeholder">&#128187;</div>
      }
    </div>
    <div class="pros-cons-area">
      <div class="pros-section">
        <h4 class="pros-title">장점</h4>
        <ul class="pros-list">
          {pros.map(p => <li><span class="icon-check">&#10003;</span> {p}</li>)}
        </ul>
      </div>
      <div class="cons-section">
        <h4 class="cons-title">단점</h4>
        <ul class="cons-list">
          {cons.map(c => <li><span class="icon-x">&#10005;</span> {c}</li>)}
        </ul>
      </div>
    </div>
  </div>

  <p class="rec-text"><strong>추천 대상:</strong> {recommendation}</p>

  <div class="review-card-actions">
    <a href="#" class="cta-btn" data-product={productId} data-store={store} rel="nofollow noopener" target="_blank">쿠팡 최저가 보기</a>
    {reviewUrl && <a href={reviewUrl} class="btn btn-ghost">상세 리뷰 &rarr;</a>}
  </div>
</div>

<style>
  .review-card {
    background: var(--bg-card, #fff);
    border: 1px solid var(--border, #e2e8f0);
    border-radius: 16px;
    padding: 32px 36px;
    margin-bottom: 28px;
    transition: all 0.3s ease;
  }
  .review-card:hover {
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
    border-color: var(--primary, #2563eb);
  }

  /* 상단: 배지 + 점수 */
  .review-card-top {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    margin-bottom: 16px;
  }

  .review-score {
    display: flex;
    align-items: baseline;
    gap: 2px;
    background: #1e293b;
    color: #fff;
    padding: 12px 18px;
    border-radius: 12px;
    flex-shrink: 0;
  }
  .score-num {
    font-size: 22px;
    font-weight: 800;
    line-height: 1;
  }
  .score-total {
    font-size: 13px;
    font-weight: 500;
    opacity: 0.7;
  }

  /* 제목 / 부제 */
  .review-title {
    font-size: 22px;
    font-weight: 700;
    color: var(--text, #1e293b);
    margin: 0 0 4px;
  }
  .review-subtitle {
    font-size: 14px;
    color: var(--text-secondary, #64748b);
    margin: 0;
  }

  /* 스펙 한 줄 */
  .review-card-specs {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
    padding: 16px 0;
    margin: 16px 0 20px;
    border-top: 1px solid var(--border-light, #f1f5f9);
    border-bottom: 1px solid var(--border-light, #f1f5f9);
  }
  .spec {
    font-size: 14px;
    color: var(--text-secondary, #64748b);
  }
  .spec strong {
    color: var(--text, #1e293b);
    font-weight: 600;
  }

  /* 중간: 이미지 + 장단점 */
  .review-card-middle {
    display: grid;
    grid-template-columns: 260px 1fr;
    gap: 28px;
    margin-bottom: 20px;
    align-items: start;
  }

  .review-card-image {
    background: #1e293b;
    border-radius: 12px;
    padding: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 180px;
  }
  .review-card-image img {
    max-width: 100%;
    height: auto;
    object-fit: contain;
  }
  .product-placeholder {
    font-size: 56px;
    opacity: 0.4;
    filter: grayscale(1);
  }

  /* 장단점 2열 */
  .pros-cons-area {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 24px;
    align-items: start;
  }

  .pros-title {
    color: #16a34a;
    font-size: 14px;
    font-weight: 700;
    margin: 0 0 12px;
  }
  .cons-title {
    color: #dc2626;
    font-size: 14px;
    font-weight: 700;
    margin: 0 0 12px;
  }

  .pros-list,
  .cons-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  .pros-list li,
  .cons-list li {
    font-size: 14px;
    display: flex;
    gap: 8px;
    align-items: flex-start;
    color: var(--text, #1e293b);
    line-height: 1.5;
  }
  .icon-check {
    color: #16a34a;
    font-weight: 700;
    flex-shrink: 0;
    font-size: 15px;
  }
  .icon-x {
    color: #dc2626;
    font-weight: 700;
    flex-shrink: 0;
    font-size: 15px;
  }

  /* 추천 대상 */
  .rec-text {
    font-size: 14px;
    color: var(--text-secondary, #64748b);
    line-height: 1.7;
    margin: 0 0 24px;
  }
  .rec-text strong {
    color: var(--text, #1e293b);
  }

  /* 버튼 */
  .review-card-actions {
    display: flex;
    gap: 12px;
    align-items: center;
  }

  /* 반응형 */
  @media (max-width: 900px) {
    .review-card-middle {
      grid-template-columns: 200px 1fr;
      gap: 20px;
    }
  }
  @media (max-width: 768px) {
    .review-card {
      padding: 24px 20px;
    }
    .review-card-middle {
      grid-template-columns: 1fr;
    }
    .review-card-image {
      max-width: 280px;
    }
    .pros-cons-area {
      grid-template-columns: 1fr;
    }
    .review-title {
      font-size: 18px;
    }
    .review-card-specs {
      gap: 12px;
    }
  }
</style>
